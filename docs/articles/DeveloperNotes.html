<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Developer Notes • rivRmon</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Developer Notes">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-147990841-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147990841-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rivRmon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dbca-wa/rivRmon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Developer Notes</h1>
                        <h4 data-toc-skip class="author">Bart
Huntley</h4>
            
            <h4 data-toc-skip class="date">2025-01-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dbca-wa/rivRmon/blob/HEAD/vignettes/DeveloperNotes.Rmd" class="external-link"><code>vignettes/DeveloperNotes.Rmd</code></a></small>
      <div class="d-none name"><code>DeveloperNotes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The <code>rivRmon</code> package was developed back in 2019 to fill a
need in the Department’s reporting on the Swan and Canning Rivers. The
initial brief was to create a product that had the same look and feel as
reporting that had been undertaken using a proprietary software.</p>
<p>After the initial development, further functionality
(e.g. phytoplankton reporting) was added as were tweaks to the original
surfer plots to accommodate extra sites, deeper profiles, better
interpolation etc. As with a lot of projects like this, time was always
the limiting factor and the package, whilst still robust at time of
writing, would benefit from some refactoring and removal of older
package dependencies.</p>
<p>The intention of these notes is to aid any future developer in
navigating the package structure and hopefully give some context around
decisions made when formulating the code base.</p>
</div>
<div class="section level2">
<h2 id="package-structure">Package structure<a class="anchor" aria-label="anchor" href="#package-structure"></a>
</h2>
<p>The basic package structure should look familiar to anyone who has
had experience with writing R packages. In a nutshell though:</p>
<ul>
<li>
<code>rivRmon</code> is hosted on the <a href="https://github.com/dbca-wa/rivRmon" class="external-link">Department’s GitHub
account</a>.</li>
<li>
<code>rivRmon</code> has a <a href="https://dbca-wa.github.io/rivRmon/index.html">supporting
website</a> hosted through GitHub pages created by using the
<code>pkgdown</code> R package which automates the creation of all files
necessary for a static website. As such there are extra directories and
files in the GitHub repo that do not form part of an R package and are
noted in the .Rbuildignore file.</li>
<li>new version releases are managed through GitHub’s Release
functionality.</li>
<li>new releases have been linked to a <a href="https://zenodo.org/records/14166500" class="external-link">Zenodo DOI</a>. If future
versions are published please add your own ORCID account and I would
appreciate still being attached.</li>
</ul>
<p>A fabulous resource to get up to speed on R package development and
covers most of the above is the excellent resource <a href="https://r-pkgs.org/" class="external-link">R Packages</a>. For GitHub integration with R
Studio try <a href="https://happygitwithr.com/" class="external-link">Happy Git and GitHub for
the useR</a>.</p>
<p>Any work on the package should follow:</p>
<ul>
<li>Source the latest version from GitHub.</li>
<li>Make edits/changes to code.</li>
<li>Commit changes locally.</li>
<li>Perform extensive testing locally.</li>
<li>Rebuild package (new version), documentation and website
locally.</li>
<li>Update package NEWS file.</li>
<li>Test loading of package.</li>
<li>Run package R CMD checks and clear up any errors.</li>
<li>Retest package after loading new version.</li>
<li>Commit all changes along the way locally.</li>
<li>Push new package to GitHub repository.</li>
<li>Create a new release and ensure same in Zenodo (where DOI is
minted).</li>
<li>Tell users that a new package is available and how to access.</li>
</ul>
</div>
<div class="section level2">
<h2 id="additional-package-notes">Additional package notes<a class="anchor" aria-label="anchor" href="#additional-package-notes"></a>
</h2>
<div class="section level3">
<h3 id="internal-data">Internal data<a class="anchor" aria-label="anchor" href="#internal-data"></a>
</h3>
<p>There are two sources of internal data that are required for the
package to operate and are bundled with the software. The first can be
found in <code>.data/</code> and covers the management response
triggers. It is a <code>.rda</code> file and if required can be
recreated and updated easily in R if required.</p>
<p>The second internal data source resides in the <code>.R/</code>
directory as the <code>sysdata.rda</code> file and contains a lot of
extra data including:</p>
<ul>
<li>site locations and information.</li>
<li>locations of the oxy plants.</li>
<li>coordinates used for the bathymetry (bottom profiles of the surfer
plots).</li>
<li>pre-baked interpolation grids.</li>
<li>reclassification matrices used to bin continuous metric values so
that discrete colour scales can be used.</li>
<li>coordinates used for “black-out” rectangles for missing data.</li>
<li>the phytoplankton plotting colour scale.</li>
</ul>
<p>Recreating this data can be accomplished by editing and running the
script found at <code>data-raw/internal_data.R</code>. Note that adding
new sites is accomplished by editing a shape file that maintains the
spatial integrity of the relationship between the sampling sites and the
bathymetry. The file path to the shape file is in the script and access
can be gained by contacting the DBCA RSSA program.</p>
<p>It is also worth noting that not all of the
<code>inetrnal_data.R</code> script can be successfully run at present.
Whilst this has no impact on <code>rivRmon</code> in its present form an
update to this should be completed to negate future issues. Attention
needs to be paid to updating any older package dependencies that are
required to build the interpolation grids, namely <code>rgdal</code>,
<code>rgeos</code>, <code>raster</code> and possibly <code>sp</code>.
These are all spatial packages and would benefit from being upgraded to
utilise functionality from <code>terra</code> and <code>sf</code>, their
modern equivalents.</p>
<p>As <code>sysdata.rda</code> is just a data file with multiple objects
there is an easy workaround if only certain objects need updating.
Starting with a clean environment, clicking on <code>sysdata.rda</code>
in R studio will load all objects into the environment. The developer
can then update the required object and then resave as
<code>sysdata.rda</code> (see bottom of the <code>inetrnal_data.R</code>
script for more notes and what objects are required).</p>
</div>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<p>Most functions live in their own <code>.R</code> files as they are
generally quite long and can be complicated. Internal functions
(i.e. helper functions run inside the main functions but are not
exported with the package) are contained in <code>data-prep.R</code> and
contain helpers for:</p>
<ul>
<li>for finding the correct workbooks for input to surfer and phyto
functions.</li>
<li>ingesting the sonde data and standardizing the output for the surfer
plots and a special case version for use with the ad hoc
<code><a href="../reference/plot_metric.html">plot_metric()</a></code> function.</li>
<li>colour scales for the surfer plots.</li>
<li>creating a pretty date (i.e. 1st, 2nd, 3rd, 4th etc).</li>
</ul>
</div>
<div class="section level3">
<h3 id="surfer-concept">Surfer concept<a class="anchor" aria-label="anchor" href="#surfer-concept"></a>
</h3>
<p>As previously mentioned, the <code>surfR</code> functions were
developed to imitate the exact outputs from a proprietary software. To
accomplish this, it necessitated a departure from some very capable (and
easier to maintain) plotting paradigms. Therefore it may be helpful to
understand the internal “process” and design choices in a
<code>sufR</code> function and this is generalised below:</p>
<ul>
<li>File paths to data workbooks (1 per sonde) are established with
internal checks to establish correct river <code>sufR</code> is being
called.</li>
<li>Sonde data is read in and aggregated. The helper function here was
necessarily complicated as many different sondes had been used with no
real standardisation in naming of metrics.</li>
<li>Depth profiles are sourced.</li>
<li>Data for the interpolations is collated.</li>
<li>Data is interpolated over sourced grids.</li>
<li>Sampling locations are determined and locations restricted to those
appearing in data (standard and response sites).</li>
<li>Sampling site labels are generated, omitting those that
overplot.</li>
<li>Black out rectangles are generated for any missing data.</li>
<li>Individual ggplot2 objects are created for each of the 4 metrics
with very specific themes per plot to allow correct axis labels
etc.</li>
<li>plots are arranged into a panel layout and written to
<code>.png</code>.</li>
<li>Swan <code>surfR</code> always outputs a whole of river plot and a
“Narrows and up” plot.</li>
<li>Canning <code>surfR</code> determines if the Kent Street weir should
be included based on the presence of some sampling sites. If it is, an
alternate bathymetry profile is chosen and the interpolation is now
split over two grids that meet at the weir. This is because the weir
produces a boundary for the interpolation.</li>
</ul>
</div>
<div class="section level3">
<h3 id="last-thoughts">Last thoughts<a class="anchor" aria-label="anchor" href="#last-thoughts"></a>
</h3>
<p>If this is all very new to a new maintainer/developer then please
practice creating packages before attempting any irreversible changes to
the DBCA-WA repository. Whilst Git is great for version control you have
to know Git to do it. There are dozens of resources out there for
practicing package creation and GitHub workflows. Lastly you will need
to contact OIM to be added as an administrator to the
<code>dbac-wa/rivRmon</code> repository to be able to push any changes
to the package.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bart Huntley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
