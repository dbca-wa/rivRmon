<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to make plots and tables for annual reports • rivRmon</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to make plots and tables for annual reports">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-147990841-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147990841-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rivRmon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dbca-wa/rivRmon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to make plots and tables for annual reports</h1>
                        <h4 data-toc-skip class="author">Bart
Huntley</h4>
            
            <h4 data-toc-skip class="date">2024-11-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dbca-wa/rivRmon/blob/HEAD/vignettes/annual_reports.Rmd" class="external-link"><code>vignettes/annual_reports.Rmd</code></a></small>
      <div class="d-none name"><code>annual_reports.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>All water quality data, historical and present, is accessed through
the Water Information Reporting portal maintained by the Department of
Water and Environment <a href="http://wir.water.wa.gov.au/Pages/Water-Information-Reporting.aspx" class="external-link">link</a>.
Data should be downloaded for the Canning Estuary and the Swan Estuary
sites using the keywords search terms “SG-E-CANEST” and “SG-E-SWANEST”
respectively. Data requested should be “Water Quality (discrete) for
Site(s) cross-tabulated” and as the data size is large, requests should
be split into appropriate yearly chunks. This data is the starting point
for using the functions that follow to produce plots and tables for the
annual reports. It is suggested that the original downloads be kept and
the data simply updated yearly.</p>
<p>The plots created by the functions are output as panel plots and
follow the same format as previous annual reports. A panel is based on a
variable and contains a separate plot for each combination of ecological
management zone (emz) and sampling method. Visualisation consists
of:</p>
<ul>
<li>a “ribbon” designating the 10th and 90th percentiles of the
background data</li>
<li>a line showing the background data median</li>
<li>points showing the current reporting period medians</li>
</ul>
<p>The tables generated from the same functions contain counts,
minimums, maximums and medians for the current reporting period per
month. These are summarised by emz and sampling method and can be copied
straight into the report when it is being compiled.</p>
<p>The process for creating the plots and tables has two stages.</p>
</div>
<div class="section level2">
<h2 id="stage-one---data-assembly">Stage One - Data assembly<a class="anchor" aria-label="anchor" href="#stage-one---data-assembly"></a>
</h2>
<p>Data required for the annual reports consists of a current reporting
period (01 June to 31 May) and background period (5 years prior to
current reporting period). In this stage all downloaded data is read in
and categorised into a current and background period. The downloaded
data has some challenging formatting (for automatic reading and variable
naming etc) so these functions are very specific to the current export
format. Should this format change these functions will fail and require
some editing.</p>
<p>When the report is read in it is tidied with the following
occuring:</p>
<ul>
<li>variable names are standardised</li>
<li>values are checked for “&lt;” or “&gt;”:
<ul>
<li>a value following a “&lt;” is halved</li>
<li>a value following a “&gt;” is left as is</li>
</ul>
</li>
<li>the variable emz is created based on site</li>
</ul>
<p>Once the data is read in and tidied it is exported as a csv with the
format “XX-X-XXXXX_annual_report_data_for_YYY.csv” where:</p>
<ul>
<li>“XX-X-XXXXX” is the estuary (i.e. SG-E-CANEST or SG-E-SWANEST)</li>
<li>“YYYY” is the current reporting year.</li>
</ul>
<p>Remember to change the file path slashes if on a Windows OS. Examples
below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dbca-wa/rivRmon" class="external-link">rivRmon</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Canning estuary - forward slash example</span></span>
<span><span class="fu"><a href="../reference/canning_WIN_report_data.html">canning_WIN_report_data</a></span><span class="op">(</span>inpath <span class="op">=</span> <span class="st">"C:blah/blah/annual_data_location"</span>, </span>
<span>                        reportingYear <span class="op">=</span> <span class="fl">2019</span>, </span>
<span>                        outpath <span class="op">=</span> <span class="st">"C:blah/blah/somewhere"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Swan estuary - backslash example</span></span>
<span><span class="fu"><a href="../reference/swan_WIN_report_data.html">swan_WIN_report_data</a></span><span class="op">(</span>inpath <span class="op">=</span> <span class="st">"C:blah\\blah\\annual_data_location"</span>, </span>
<span>                     reportingYear <span class="op">=</span> <span class="fl">2019</span>, </span>
<span>                     outpath <span class="op">=</span> <span class="st">"C:blah\\blah\\somewhere"</span><span class="op">)</span></span></code></pre></div>
<p><strong>inpath</strong> is a character file path to the downloaded
data xlsx files <strong>reportingYear</strong> is a 4 digit numerical
representing current reporting year <strong>outpath</strong> is a
character file path to desired export location for writing of the csv
files</p>
<p>This function needs to be run each year to set up the data for the
annual report. The output from this stage will be the input for the next
two stages.</p>
</div>
<div class="section level2">
<h2 id="stage-two---creating-plots-and-tables">Stage Two - Creating plots and tables<a class="anchor" aria-label="anchor" href="#stage-two---creating-plots-and-tables"></a>
</h2>
<p>There is a separate function for each estuary. These are essentially
wrapper functions around other functions that work on data that has the
same requirements for visualisation (mainly formatting such as plots per
panel, or data filtering parameters etc). Outputs are saved to
directories created by running the functions. There will be a
<code>panels</code> and a <code>tables</code> directory with the prefix
“c_” or “s_” for Canning and Swan estuaries respectively.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Canning estuary - forward slash example</span></span>
<span><span class="fu"><a href="../reference/canning_reportR.html">canning_reportR</a></span><span class="op">(</span>inpath <span class="op">=</span> <span class="st">"C:blah/blah/somewhere"</span>, </span>
<span>                outpath <span class="op">=</span> <span class="st">"C:blah/blah/somewhere_else"</span>, </span>
<span>                surface <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>                bottom <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                chloro <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Swan estuary - backslash example</span></span>
<span><span class="fu"><a href="../reference/swan_reportR.html">swan_reportR</a></span><span class="op">(</span>inpath <span class="op">=</span> <span class="st">"C:blah\\blah\\somewhere"</span>, </span>
<span>                outpath <span class="op">=</span> <span class="st">"C:blah\\blah\\somewhere_else"</span>, </span>
<span>                surface <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>                bottom <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                chloro <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span></code></pre></div>
<p><strong>inpath</strong> a character file path to pre-made annual
report data (the out path from Stage 1 above)</p>
<p><strong>outpath</strong> a character file path to desired export
location</p>
<p>The parameters <strong>surface</strong>, <strong>bottom</strong> and
<strong>chloro</strong> can take a named colour or a <a href="http://instant-eyedropper.com/info/html_color_code/" class="external-link">hex colour
code</a>. The defaults produce colours similar to those produced in
prior reports, however access to these parameters allows users to tweak
if required. <strong>surface</strong> relates to surface measurements,
<strong>bottom</strong> to bottom measurements and
<strong>chloro</strong> to integrated measurements specific only to
chlorophyll plots.</p>
<div class="section level4">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h4>
<p>Canning estuary total oxidised nitrogen.</p>
<p><img src="../reference/figures/nox.png"></p>
<p>Swan estuary chlorophyll a.</p>
<p><img src="../reference/figures/chloro.png"></p>
<p>Chlorophyll a csv table</p>
<p><img src="../reference/figures/table.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="groupings-of-variables">Groupings of variables<a class="anchor" aria-label="anchor" href="#groupings-of-variables"></a>
</h2>
<p>As stated previously some variables are grouped so that code can
filter data under similar circumstances. These groupings are as
follows.</p>
<p>For the Canning estuary:</p>
<ul>
<li>chlorophyll a - by itself</li>
<li>dissolved organic carbon - by itself</li>
<li>group 1
<ul>
<li>total nitrogen</li>
<li>ammonia nitrogen</li>
<li>total oxidised nitrogen</li>
<li>dissolved organic nitrogen</li>
<li>total phosphorus</li>
<li>filterable reactive phosphorus</li>
</ul>
</li>
<li>group 3
<ul>
<li>dissolved oxygen</li>
<li>pH</li>
<li>salinity</li>
<li>temperature</li>
</ul>
</li>
<li>secchi depth - by itself</li>
<li>silica - by itself</li>
</ul>
<p>For the Swan estuary:</p>
<ul>
<li>chlorophyll a - by itself</li>
<li>group 1
<ul>
<li>total nitrogen</li>
<li>ammonia nitrogen</li>
<li>total oxidised nitrogen</li>
<li>dissolved organic nitrogen</li>
<li>total phosphorus</li>
<li>filterable reactive phosphorus</li>
<li>silica</li>
</ul>
</li>
<li>group 2
<ul>
<li>alkalinity (not report variable for Canning estuary)</li>
<li>dissolved organic carbon</li>
<li>tss (not report variable for Canning estuary)</li>
</ul>
</li>
<li>group 3
<ul>
<li>dissolved oxygen</li>
<li>pH</li>
<li>salinity</li>
<li>temperature</li>
</ul>
</li>
<li>secchi depth</li>
</ul>
<p>Note that <code>swan_reportR</code> outputs 2 panel plots as per the
original report for the group 3 variables. The extra panel plots are for
the additional emz of “Swan”.</p>
</div>
<div class="section level2">
<h2 id="plotting-individual-variable-groupings">Plotting individual variable groupings<a class="anchor" aria-label="anchor" href="#plotting-individual-variable-groupings"></a>
</h2>
<p>As previously mentioned, the reportR functions are wrappers. The
individual functions are available to the user and can be found in the
reference index. The groupings match the above and function names take
the format <code>ann_rep_vvvv_e()</code> where:</p>
<ul>
<li>“vvvv” is the variable or grouping</li>
<li>“_e” is the estuary (“_c” or “_s”)</li>
</ul>
<p>As these functions are written to be internal to the wrapper they
need to be run in the following manner in order to read in the correct
data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load additional packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#setup a file path to the annual report data (i.e. csv from Stage One)</span></span>
<span><span class="va">inpath</span> <span class="op">&lt;-</span> <span class="st">"C:path/to/anuual_report_data"</span></span>
<span></span>
<span><span class="co">#get the full name and pathrow to the required data - change pattern as required</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">inpath</span>, pattern <span class="op">=</span> <span class="st">"SG-E-CANEST_annual_report"</span>, </span>
<span>                   full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#create parameter variables for the function you want to use</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="st">"C:path/to/desired_export_location"</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">file</span>, guess_max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#run function - here we have chosen group 1 variables for the Swan</span></span>
<span><span class="fu"><a href="../reference/ann_rep_grp1_s.html">ann_rep_grp1_s</a></span><span class="op">(</span><span class="va">outpath</span>, <span class="va">data</span>, surface <span class="op">=</span> <span class="st">"blue"</span>, bottom <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bart Huntley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
