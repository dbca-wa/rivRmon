<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to make plots and tables for annual reports • rivRmon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to make plots and tables for annual reports">
<meta property="og:description" content="rivRmon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-147990841-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147990841-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rivRmon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Bartesto/rivRmon/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to make plots and tables for annual reports</h1>
                        <h4 class="author">Bart Huntley</h4>
            
            <h4 class="date">2020-06-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Bartesto/rivRmon/blob/master/vignettes/annual_reports.Rmd"><code>vignettes/annual_reports.Rmd</code></a></small>
      <div class="hidden name"><code>annual_reports.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>All water quality data, historical and present, is accessed through the Water Information Reporting portal maintained by the Department of Water and Environment <a href="http://wir.water.wa.gov.au/Pages/Water-Information-Reporting.aspx">link</a>. Data should be downloaded for the Canning Estuary and the Swan Estuary sites using the keywords search terms “SG-E-CANEST” and “SG-E-SWANEST” respectively. Data requested should be “Water Quality (discrete) for Site(s) cross-tabulated” and as the data size is large, requests should be split into appropriate yearly chunks. This data is the starting point for using the functions that follow to produce plots and tables for the annual reports. It is suggested that the original downloads be kept and the data simply updated yearly.</p>
<p>The plots created by the functions are output as panel plots and follow the same format as previous annual reports. A panel is based on a variable and contains a separate plot for each combination of ecological management zone (emz) and sampling method. Visualisation consists of:</p>
<ul>
<li>a “ribbon” designating the 10th and 90th percentiles of the background data</li>
<li>a line showing the background data median</li>
<li>points showing the current reporting period medians</li>
</ul>
<p>The tables generated from the same functions contain counts, minimums, maximums and medians for the current reporting period per month. These are summarised by emz and sampling method and can be copied straight into the report when it is being compiled.</p>
<p>The process for creating the plots and tables has two stages.</p>
</div>
<div id="stage-one---data-assembly" class="section level1">
<h1 class="hasAnchor">
<a href="#stage-one---data-assembly" class="anchor"></a>Stage One - Data assembly</h1>
<p>Data required for the annual reports consists of a current reporting period (01 June to 31 May) and background period (5 years prior to current reporting period). In this stage all downloaded data is read in and categorised into a current and background period. The downloaded data has some challenging formatting (for automatic reading and variable naming etc) so these functions are very specific to the current export format. Should this format change these functions will fail and require some editing.</p>
<p>When the report is read in it is tidied with the following occuring:</p>
<ul>
<li>variable names are standardised</li>
<li>values are checked for “&lt;” or “&gt;”:
<ul>
<li>a value following a “&lt;” is halved</li>
<li>a value following a “&gt;” is left as is</li>
</ul>
</li>
<li>the variable emz is created based on site</li>
</ul>
<p>Once the data is read in and tidied it is exported as a csv with the format “XX-X-XXXXX_annual_report_data_for_YYY.csv” where:</p>
<ul>
<li>“XX-X-XXXXX” is the estuary (i.e. SG-E-CANEST or SG-E-SWANEST)</li>
<li>“YYYY” is the current reporting year.</li>
</ul>
<p>Remember to change the file path slashes if on a Windows OS. Examples below.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co">#load the package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rivRmon</span>)

<span class="co">#Canning estuary - forward slash example</span>
<span class="fu"><a href="../reference/canning_WIN_report_data.html">canning_WIN_report_data</a></span>(<span class="kw">inpath</span> <span class="kw">=</span> <span class="st">"C:blah/blah/annual_data_location"</span>,
                        <span class="kw">reportingYear</span> <span class="kw">=</span> <span class="fl">2019</span>,
                        <span class="kw">outpath</span> <span class="kw">=</span> <span class="st">"C:blah/blah/somewhere"</span>)

<span class="co">#Swan estuary - backslash example</span>
<span class="fu"><a href="../reference/swan_WIN_report_data.html">swan_WIN_report_data</a></span>(<span class="kw">inpath</span> <span class="kw">=</span> <span class="st">"C:blah\\blah\\annual_data_location"</span>,
                     <span class="kw">reportingYear</span> <span class="kw">=</span> <span class="fl">2019</span>,
                     <span class="kw">outpath</span> <span class="kw">=</span> <span class="st">"C:blah\\blah\\somewhere"</span>)</pre></body></html></div>
<p><strong>inpath</strong> is a character file path to the downloaded data xlsx files <strong>reportingYear</strong> is a 4 digit numerical representing current reporting year <strong>outpath</strong> is a character file path to desired export location for writing of the csv files</p>
<p>This function needs to be run each year to set up the data for the annual report. The output from this stage will be the input for the next two stages.</p>
</div>
<div id="stage-two---creating-plots-and-tables" class="section level1">
<h1 class="hasAnchor">
<a href="#stage-two---creating-plots-and-tables" class="anchor"></a>Stage Two - Creating plots and tables</h1>
<p>There is a separate function for each estuary. These are essentially wrapper functions around other functions that work on data that has the same requirements for visualisation (mainly formatting such as plots per panel, or data filtering parameters etc). Outputs are saved to directories created by running the functions. There will be a <code>panels</code> and a <code>tables</code> directory with the prefix “c_” or “s_” for Canning and Swan estuaries respectively.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">#Canning estuary - forward slash example</span>
<span class="fu"><a href="../reference/canning_reportR.html">canning_reportR</a></span>(<span class="kw">inpath</span> <span class="kw">=</span> <span class="st">"C:blah/blah/somewhere"</span>,
                <span class="kw">outpath</span> <span class="kw">=</span> <span class="st">"C:blah/blah/somewhere_else"</span>,
                <span class="kw">surface</span> <span class="kw">=</span> <span class="st">"blue"</span>,
                <span class="kw">bottom</span> <span class="kw">=</span> <span class="st">"red"</span>,
                <span class="kw">chloro</span> <span class="kw">=</span> <span class="st">"darkgreen"</span>)

<span class="co">#Swan estuary - backslash example</span>
<span class="fu"><a href="../reference/swan_reportR.html">swan_reportR</a></span>(<span class="kw">inpath</span> <span class="kw">=</span> <span class="st">"C:blah\\blah\\somewhere"</span>,
                <span class="kw">outpath</span> <span class="kw">=</span> <span class="st">"C:blah\\blah\\somewhere_else"</span>,
                <span class="kw">surface</span> <span class="kw">=</span> <span class="st">"blue"</span>,
                <span class="kw">bottom</span> <span class="kw">=</span> <span class="st">"red"</span>,
                <span class="kw">chloro</span> <span class="kw">=</span> <span class="st">"darkgreen"</span>)</pre></body></html></div>
<p><strong>inpath</strong> a character file path to pre-made annual report data (the out path from Stage 1 above)</p>
<p><strong>outpath</strong> a character file path to desired export location</p>
<p>The parameters <strong>surface</strong>, <strong>bottom</strong> and <strong>chloro</strong> can take a named colour or a <a href="http://instant-eyedropper.com/info/html_color_code/">hex colour code</a>. The defaults produce colours similar to those produced in prior reports, however access to these parameters allows users to tweak if required. <strong>surface</strong> relates to surface measurements, <strong>bottom</strong> to bottom measurements and <strong>chloro</strong> to integrated measurements specific only to chlorophyll plots.</p>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h3>
<p>Canning estuary total oxidised nitrogen.</p>
<p><img src="plots/nox.PNG"></p>
<p>Swan estuary chlorophyll a.</p>
<p><img src="plots/chloro.PNG"></p>
<p>Chlorophyll a csv table</p>
<p><img src="plots/table.PNG"></p>
</div>
</div>
<div id="groupings-of-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#groupings-of-variables" class="anchor"></a>Groupings of variables</h1>
<p>As stated previously some variables are grouped so that code can filter data under similar circumstances. These groupings are as follows.</p>
<p>For the Canning estuary:</p>
<ul>
<li>chlorophyll a - by itself</li>
<li>dissolved organic carbon - by itself</li>
<li>group 1
<ul>
<li>total nitrogen</li>
<li>ammonia nitrogen</li>
<li>total oxidised nitrogen</li>
<li>dissolved organic nitrogen</li>
<li>total phosphorus</li>
<li>filterable reactive phosphorus</li>
</ul>
</li>
<li>group 3
<ul>
<li>dissolved oxygen</li>
<li>pH</li>
<li>salinity</li>
<li>temperature</li>
</ul>
</li>
<li>secchi depth - by itself</li>
<li>silica - by itself</li>
</ul>
<p>For the Swan estuary:</p>
<ul>
<li>chlorophyll a - by itself</li>
<li>group 1
<ul>
<li>total nitrogen</li>
<li>ammonia nitrogen</li>
<li>total oxidised nitrogen</li>
<li>dissolved organic nitrogen</li>
<li>total phosphorus</li>
<li>filterable reactive phosphorus</li>
<li>silica</li>
</ul>
</li>
<li>group 2
<ul>
<li>alkalinity (not report variable for Canning estuary)</li>
<li>dissolved organic carbon</li>
<li>tss (not report variable for Canning estuary)</li>
</ul>
</li>
<li>group 3
<ul>
<li>dissolved oxygen</li>
<li>pH</li>
<li>salinity</li>
<li>temperature</li>
</ul>
</li>
<li>secchi depth</li>
</ul>
<p>Note that <code>swan_reportR</code> outputs 2 panel plots as per the original report for the group 3 variables. The extra panel plots are for the additional emz of “Swan”.</p>
</div>
<div id="plotting-individual-variable-groupings" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-individual-variable-groupings" class="anchor"></a>Plotting individual variable groupings</h1>
<p>As previously mentioned, the reportR functions are wrappers. The individual functions are available to the user and can be found in the reference index. The groupings match the above and function names take the format <code>ann_rep_vvvv_e()</code> where:</p>
<ul>
<li>“vvvv” is the variable or grouping</li>
<li>"_e" is the estuary ("_c" or "_s")</li>
</ul>
<p>As these functions are written to be internal to the wrapper they need to be run in the following manner in order to read in the correct data.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">#load additional packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)

<span class="co">#setup a file path to the annual report data (i.e. csv from Stage One)</span>
<span class="no">inpath</span> <span class="kw">&lt;-</span> <span class="st">"C:path/to/anuual_report_data"</span>

<span class="co">#get the full name and pathrow to the required data - change pattern as required</span>
<span class="no">file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="no">inpath</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"SG-E-CANEST_annual_report"</span>,
                   <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">#create parameter variables for the function you want to use</span>
<span class="no">outpath</span> <span class="kw">&lt;-</span> <span class="st">"C:path/to/desired_export_location"</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">file</span>, <span class="kw">guess_max</span> <span class="kw">=</span> <span class="fl">10000</span>)

<span class="co">#run function - here we have chosen group 1 variables for the Swan</span>
<span class="fu"><a href="../reference/ann_rep_grp1_s.html">ann_rep_grp1_s</a></span>(<span class="no">outpath</span>, <span class="no">data</span>, <span class="kw">surface</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">bottom</span> <span class="kw">=</span> <span class="st">"red"</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bart Huntley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
